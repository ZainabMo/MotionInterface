<!-- References:
  https://stackoverflow.com/questions/54416318/how-to-make-a-undo-redo-function
  https://stackoverflow.com/questions/56514116/how-do-i-get-deviceorientationevent-and-devicemotionevent-to-work-on-safari
  https://developer.mozilla.org/en-US/docs/Web/Events/Detecting_device_orientation
 -->

<!DOCTYPE html>
<html>
<head>
  <title>Homework 3</title>
  <link rel="stylesheet" href="style.css" />
  <!-- <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.css"
    /> -->
  <!-- use directional motion but user shudnt need to shake(excessive acceleration) make sureno accidental invocation -->
  <!-- change in plane, creativity - add feedback mby?
  dont map to state (NOT if x=.. SHUD BE 
  if angle changes from 0 to greater 50(or give grace of extra degrees,
  maybe case of accidental phonedrop?),
  if has changed let them make phone straight again
   add max PLUS), but to transition/change,
   + time threshhold toprevent accident
   
   and it shud happen only once 
    whats best for the user? fwd backward? left right? wat abt for dlefthanded ppl(dont think it wud matter)
  -->
</head>
<body>
  <input id="input" type="text"/>
  <button id="start">Start</button>

  <script type="text/javascript" src="jquery-3.6.0.min.js"></script>

  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" crossorigin="anonymous"></script> -->
  <script type="text/javascript">
    (function($) {
      $(document).ready(function() {
        if (location.protocol != "https:") {
          location.href = "https:" + window.location.href.substring(window.location.protocol.length);
        }
        $("#start").click(function () {
          if (typeof(DeviceMotionEvent) !== "undefined" && typeof(DeviceMotionEvent.requestPermission) === "function") {
            DeviceMotionEvent.requestPermission()
              .then(response => {
                if (response == "granted") {
                  window.addEventListener("deviceorientation", handleOrientation, true);
                  window.addEventListener("deviceorientation", getInitialAngle, true);
                  $("#start").remove();
                }
              })
              .catch(console.error);
          } else {
            alert("DeviceMotionEvent is undefined.");
          }
        });
        
        function getInitialAngle(event){
          return event.gamma;
        }
        function handleOrientation(event) {
            var initialY = setInterval(getInitialAngle, 5000);
            // var x = event.beta; // In degree in the range [-180,180)
            var currentY = event.gamma; // In degree in the range [-90,90)
            var tilted = false;
            //Left tilt is undo and right tilt is redo, since English is read left to right
            //Left: initial position is 
            if((currentY > initialY-55) && (currentY < initialY+10) && !tilted){ //45 + 10 degrees grace
              tilted=true;
              setTimeout(function(){
                undo();
              }, 2500);
            }
            //Right
            if((currentY < initialY+55) && (currentY > initialY-10) && !tilted){
              tilted=true;
              setTimeout(function(){
                redo();
              }, 2500);
            }
            //When phone is back up, change tilted to false
            if((currentY > initialY-10) && (currentY < initialY+10)){
              tilted = false;
            }
        }
       
        const UndoMementos = []
        const RedoMementos = []
        const input = document.querySelector('input')
        input.addEventListener('input', saveMemento);
        function saveMemento() {
          UndoMementos.push(input.value)
        }

        function undo() {
          RedoMementos.push(input.value)
          const lastMemento = UndoMementos.pop()
          input.value = lastMemento ? lastMemento : input.value
        }

        function redo() {
          const redoMemento = RedoMementos.pop()
          input.value = redoMemento.length > input.value.length ? redoMemento : input.value //if redo value is larger
          UndoMementos.push(input.value)
        }
      });
    })(window.jQuery);
  </script>
</body>
</html>
